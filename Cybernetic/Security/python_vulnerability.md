# Python Vulnerabilities

## CVE-2021-3177 `ctypes double representation BoF`
### Python bugs note
- Version affected 3.6 - 3.10
- Buffer overflow is against the `PyCArg_repr()` function in `_ctypes/callproc.c`
- The buffer overflow happens when not checking the length of `sprintf()` function
```c++
case 'd':
    sprintf(buffer, "<cparam '%c' (%f)>", self->tag, self->value.d);
    break;
```
- The buffer overflow is achieved by execing the number of values 
```python
from ctypes import *
c_double.from_param(1e300)
```
- The fix is to change the `sprintf` that prints to the buffer specified regardless of its size to `snprintf`
- `snprintf` will discard any extra characters once the buffer is filled

### About sprintf
- "ZComposes a string with the same text that would be printed if format was used on printf, but instead of being printed, the content is stored as a C string in the buffer pointed by str"
- 
### ZDNet notes
- The Python Software Foundation is recommending immediete upgrade to 3.9.2 and 3.8.8 to address the remote code execution
- The vulnerability affects Python 3.x through 3.9.1: A buffer overflow in `PyCArg_repr` in ctypes/callproc.c
- This overflow leads to remote execution 
- The vulnerability affects applications that "accept floating-point numbers as unstrusted input, as demonstrated by a 1e300 argument to `c_double.from_param` (zdnet)
- The bug occurs because `sprintf` is used unsafely
- The stack-based buffer overflow in python's ctypes module improperly validated the input passed to it casing the buffer overflow
- Although this is a `remote execution` buffer overflow, it may only cause DOS due to the conditions needed for the buffer overflow to be seccessful 

## Resources
[Python Bug Tracker](https://bugs.python.org/issue42938)

[ZDNet Writeup](https://www.zdnet.com/article/python-programming-language-hurries-out-update-to-tackle-remote-code-vulnerability/)

[Hex Value of 1e300](https://www.hexdictionary.com/hex/1E300)

[Sprintf function](http://www.cplusplus.com/reference/cstdio/sprintf/)
